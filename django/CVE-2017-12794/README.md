# **Django 500 Debug Page Cross-Site Scripting (XSS)**

---

> 화이트햇 스쿨 3기 김민규
> 

Django는 빠른 개발과 깔끔하고 실용적인 디자인을 장려하는 고수준 Python 웹 프레임워크입니다.

Django 1.11.5 및 1.10.8 이전 버전에서 Debug Error Page에 오류 메시지에 사용자의 입력을 escape처리 하지 않아 XSS(Cross-Side-Scripting)이 발생합니다. 

# 1. 취약한 환경 구성

---

취약한 환경을 구성하기 위해 vulnhub에서 git clone으로 환경을 받아와 줍니다. 

## 1) git clone vulhub.git

```bash
git clone https://github.com/vulhub/vulhub.git # vulhub를 git clone
```

/vulhub 에서 많은 종류의 환경 목록을 볼 수 있습니다.

![image.png](attachment:0ce90c36-b709-44b0-a17d-24f5f366158a:image.png)

## 2) docker-compose up -d

![image.png](attachment:1c874e9c-9a96-419d-b461-93b31ba6ee45:image.png)

docker-compose.yml 파일을 사용하면 빌드, 실행, 연결을 하나의 파일로, 동시에 처리해 줍니다. 

```bash
docker-compose up -d # docker-compose up -d는 빌드, 실행, 연결을 처리해줌
```

![image.png](attachment:c593fa42-ff88-4416-89f9-276d7c22fec4:image.png)

# 2. 환경 접속 & 익스플로잇

---

![image.png](attachment:18afe364-aa45-416f-8950-fa7c87596bc3:image.png)

구축한 환경은 /create_user 앤드포인트에서 username이라는 파라미터를 받습니다. 

1을 인자로 보내보니, user가 만들어졌다는 메시지를 반환합니다. 

![image.png](attachment:54ef675d-2f69-4836-9ce1-8497d48f4ca7:image.png)

같은 요청을 반복하니 Key(username) = (1) 이 이미 존재한다는 이유로 500에러를 반환한 모습입니다. 

같은 방식으로 1 대신 script 구문을 삽입해보겠습니다.

![image.png](attachment:ffc5bf5f-d95e-4754-b1d0-7b870c7be8b6:image.png)

![image.png](attachment:37de37d9-ef0a-437a-8a5d-a82f8bfeebb2:image.png)

개발자 도구로 html Elements를 확인해 보면, 에러 상세 메시지에 script 구문이 삽입되면서 스크립트가 실행된 모습을 볼 수 있습니다. 

## 📍 공격 시나리오

---

### 서버에서 XSS가 가능한 환경

→ Stored XSS 공격 가능, 웹 사이트 내 게시글이나 댓글에 스크립트 삽입, 사용자의 쿠키 탈취 가능

### 서버에서 XSS가 불가능 한 환경

→ Reflected XSS 공격 가능, 사용자에게 공격 페이로드가 포함된 URL을 전송, 클릭 유도하여 쿠키 탈취 가능

# 3. 패치

---

![image.png](attachment:48627e86-2f5d-4e55-b68f-97c0019a24fe:image.png)

취약점 발견 이후, Django에서 에러 메시지를 이스케이프 처리한 뒤 출력하도록 변경하여 패치했습니다.
